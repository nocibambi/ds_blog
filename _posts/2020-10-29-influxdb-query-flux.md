---
keywords: fastai
title: Querying InfluxDB with Flux
nb_path: _notebooks/2020-10-29-influxdb-query-flux.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-10-29-influxdb-query-flux.ipynb
-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Flux is a functional data scripting language designed specifically for time series data exploration and data processing with InfluxDB.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Key-concepts">Key concepts<a class="anchor-link" href="#Key-concepts"> </a></h2><ul>
<li>pipe-forward operator: <code>|&gt;</code>: chain operators together by passing a table to the next step</li>
<li>tables: flux formats data as annotated CSV</li>
<li>table group key: describe the table's contents as a list of those columns with non-unique values</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Example-query">Example query<a class="anchor-link" href="#Example-query"> </a></h2><ul>
<li>Queries data from the <code>example-bucket</code> bucket</li>
<li>Returns minute average cpu usage (based on tags) from the last hour</li>
</ul>

<pre><code>flux
from(bucket:"example-bucket")
  |&gt; range(start:-1h)
  |&gt; filter(fn:(r)) =&gt;
    r._measurement == "cpu" and
    r.cpu == "cpu-total"
  )
  |&gt; aggregateWindow(every: 1m, fn:mean)
  |&gt; yield()</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Elements-of-a-Flux-query">Elements of a Flux query<a class="anchor-link" href="#Elements-of-a-Flux-query"> </a></h2><p>Every flux query requires at least the following parameters</p>
<ul>
<li>data source: <code>from(bucket:"bucket-name")</code></li>
<li>time range: <code>|&gt; range(start: starting timestamp/time preceding "now", stop: end time preceding "now")</code><ul>
<li>timestamp: <code>2018-11-05T23:30:00Z</code></li>
<li>duration preceding now: <code>-15m</code> (always negative)</li>
</ul>
</li>
<li>filter:<ul>
<li><code>filter(fn(r))</code>, the only parameter is <code>fn</code> which expects an anonymous function (here <code>r</code>)</li>
<li><code>r</code>: reports or rows</li>
<li>chain operators with <code>and</code></li>
</ul>
</li>
<li>result output: <code>yield()</code> (Flux automatically assumes this, <code>yield()</code> is necessary only to return the results of multiple queries when it also need to name the output tables)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Exploring-data-with-InfluxDB-UI's-Data-Explorer">Exploring data with InfluxDB UI's Data Explorer<a class="anchor-link" href="#Exploring-data-with-InfluxDB-UI's-Data-Explorer"> </a></h2><p>The most straightforward way to explore InfluxDB is to use the UI's Data Explorer</p>
<p>Here we use flux scripting together with the interactive UI.</p>
<p>In the following flux query, we do not pass all the parameters manually but allow the use the UI to set them dynamically:</p>
<ul>
<li><code>|&gt; range(start: v.timeRangeStart, stop: v.timeRangeStop)</code>: here <code>v.timeRangeStart</code> and <code>v.timeRangeStop</code> are set with time range selector dropdown and the on the graph (with the mouse)</li>
<li><code>|&gt; aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)</code>: we define the window with <code>v.windowPeriod</code></li>
</ul>

<pre><code>from(bucket: "trial_bucket")
  |&gt; range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |&gt; filter(fn: (r) =&gt; r["_measurement"] == "boltdb_reads_total")
  |&gt; aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)</code></pre>

</div>
</div>
</div>
</div>
 

