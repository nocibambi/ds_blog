---
keywords: fastai
title: Inverse normal cumulative distribution - finding $z$ values from probabilities with Python
nb_path: _notebooks/2020-10-09-inverse-normal-cdf.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-10-09-inverse-normal-cdf.ipynb
-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sometimes we would like to find the $z$ values belonging to a particular probability. For this we use an inverse cumulative distribution function.</p>
<p>Because the cumulative distribution function is strictly increasing and continuous, we can find the $z$ by narrowing down with binary bisecting the distance between high and low $z$ values.</p>
<p>The code is based upon the respective example from <a href="https://www.oreilly.com/library/view/data-science-from/9781492041122/">Data Science from Scratch</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Libraries,-helper-functions">Libraries, helper functions<a class="anchor-link" href="#Libraries,-helper-functions"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">m</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">calc_normal_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">erf</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">m</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">column_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># return str(number).ljust(column_width)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="si">:</span><span class="s2"> &lt;</span><span class="si">{</span><span class="n">column_width</span><span class="si">}}</span><span class="s2">&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Inverse-normal-CDF">Inverse normal CDF<a class="anchor-link" href="#Inverse-normal-CDF"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The inverse normal cumulative distribution function.</p>
<p>Takes a probability and optionaly a mean and standard deviation of the distribution, and a tolerance value.</p>
<ol>
<li><p>If the distribution is not standard normal, it calculates $z$ for the standard normal one and then rescales the result</p>
</li>
<li><p>Take a very low and a very high $z$ value</p>
</li>
<li><p>While the distance between the high and low $z$ values are greater than our tolerance</p>
<p>a. Take their midpoint<br>
 b. Calculate the probability belonging to that midpoint<br>
 c. Based on the position of the probability belonging of the midpoint in respect to the probabilty for which we try to find out the $z$ value, assign the midpoint to the low or high $z$ value</p>
</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">calc_inverse_normal_cdf</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1E-5</span><span class="p">,</span> <span class="n">show_steps</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>

    <span class="c1"># In case it is not a standard normal distribution, calculate the standard normal first and then rescale</span>
    <span class="k">if</span> <span class="n">mu</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">sigma</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">calc_inverse_normal_cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>

    <span class="n">low_z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
    <span class="n">hi_z</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">while</span> <span class="n">hi_z</span> <span class="o">-</span> <span class="n">low_z</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">:</span>
        <span class="n">mid_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">low_z</span> <span class="o">+</span> <span class="n">hi_z</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">mid_p</span> <span class="o">=</span> <span class="n">calc_normal_cdf</span><span class="p">(</span><span class="n">mid_z</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mid_p</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">low_z</span> <span class="o">=</span> <span class="n">mid_z</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hi_z</span> <span class="o">=</span> <span class="n">mid_z</span>

        <span class="k">if</span> <span class="n">show_steps</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">to_string</span><span class="p">,</span> <span class="p">[</span><span class="n">low_z</span><span class="p">,</span> <span class="n">mid_z</span><span class="p">,</span> <span class="n">hi_z</span><span class="p">])))</span>

    <span class="k">return</span> <span class="n">mid_z</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can examine the steps as the $z$ closes down to its final value.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">calc_inverse_normal_cdf</span><span class="p">(</span><span class="n">p</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">show_steps</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>-10                 	0.0                 	0.0                 
-5.0                	-5.0                	0.0                 
-2.5                	-2.5                	0.0                 
-1.25               	-1.25               	0.0                 
-0.625              	-0.625              	0.0                 
-0.625              	-0.3125             	-0.3125             
-0.625              	-0.46875            	-0.46875            
-0.546875           	-0.546875           	-0.46875            
-0.546875           	-0.5078125          	-0.5078125          
-0.52734375         	-0.52734375         	-0.5078125          
-0.52734375         	-0.517578125        	-0.517578125        
-0.52734375         	-0.5224609375       	-0.5224609375       
-0.52490234375      	-0.52490234375      	-0.5224609375       
-0.52490234375      	-0.523681640625     	-0.523681640625     
-0.52490234375      	-0.5242919921875    	-0.5242919921875    
-0.52459716796875   	-0.52459716796875   	-0.5242919921875    
-0.524444580078125  	-0.524444580078125  	-0.5242919921875    
-0.524444580078125  	-0.5243682861328125 	-0.5243682861328125 
-0.5244064331054688 	-0.5244064331054688 	-0.5243682861328125 
-0.5244064331054688 	-0.5243873596191406 	-0.5243873596191406 
-0.5244064331054688 	-0.5243968963623047 	-0.5243968963623047 
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>-0.5243968963623047</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, we get a number of reference values for some different probabilities</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">calc_inverse_normal_cdf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="si">:</span><span class="s2"> &gt;20</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0.0:   -9.999990463256836
0.1:  -1.2815570831298828
0.2:  -0.8416271209716797
0.3:  -0.5243968963623047
0.4:  -0.2533435821533203
0.5: -9.5367431640625e-06
0.6:   0.2533435821533203
0.7:   0.5243968963623047
0.8:   0.8416271209716797
0.9:   1.2815570831298828
1.0:    8.244009017944336
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

